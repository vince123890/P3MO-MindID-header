import{a as l,j as e}from"./@react-router-BOJM2k20.js";import{d,S as p,R as k,C as _,F as C,P as V}from"./index-BafWvN44.js";import{S as g,C as T}from"./index-BGD_4JXV.js";import{a as E}from"./index-DSQ8494f.js";import{P as G}from"./index-DVtehMbZ.js";import{F as m}from"./index-DDk6ch2l.js";import{S as D}from"./index-HUJMorX5.js";import{B as h}from"./index-BHxSUtD9.js";import{I as Y}from"./AntdIcon-DUdM8fG5.js";import{T as N}from"./index-QOKA2q-x.js";import{R as B}from"./DownloadOutlined-B7YLRgp7.js";import{s as f}from"./index-Cskjed0c.js";import"./reactNode-Csz1gYGy.js";import"./Skeleton-BKwTcTmI.js";import"./index-CrLFCoSO.js";import"./PlusOutlined-DDuQXVnN.js";import"./index-knJtj6sN.js";import"./tiny-invariant-DsAsvojH.js";import"./useForm-CJYsS5GE.js";import"./ExclamationCircleFilled-C_fPh9YD.js";import"./InfoCircleFilled-D4ctpFmw.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="ddcd492c-d8bb-4c60-9bd6-d992eb139fc1",t._sentryDebugIdIdentifier="sentry-dbid-ddcd492c-d8bb-4c60-9bd6-d992eb139fc1")}catch{}var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M820 436h-40c-4.4 0-8 3.6-8 8v40c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-40c0-4.4-3.6-8-8-8zm32-104H732V120c0-4.4-3.6-8-8-8H300c-4.4 0-8 3.6-8 8v212H172c-44.2 0-80 35.8-80 80v328c0 17.7 14.3 32 32 32h168v132c0 4.4 3.6 8 8 8h424c4.4 0 8-3.6 8-8V772h168c17.7 0 32-14.3 32-32V412c0-44.2-35.8-80-80-80zM360 180h304v152H360V180zm304 664H360V568h304v276zm200-140H732V500H292v204H160V412c0-6.6 5.4-12 12-12h680c6.6 0 12 5.4 12 12v292z"}}]},name:"printer",theme:"outlined"};function j(){return j=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},j.apply(this,arguments)}const A=(t,n)=>l.createElement(Y,j({},t,{ref:n,icon:J})),U=l.forwardRef(A);function x(){return x=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},x.apply(this,arguments)}const W=(t,n)=>l.createElement(Y,x({},t,{ref:n,icon:q})),K=l.forwardRef(W),Q=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],P=t=>Q[t-1]||"Unknown",X=(t,n,o)=>({status_code:200,data:{id:`generated_${Date.now()}`,project_id:t,period_start:n,period_end:o,generated_at:new Date().toISOString(),file_path:"/docs/Laporan bulan Oktober.pdf",file_name:`Laporan ${P(new Date(n).getMonth()+1)} ${new Date(n).getFullYear()}`,status:"completed"},version:"1.0.0"}),{Title:Z,Text:M}=N;function ee(){const[t]=m.useForm(),[n,o]=l.useState(!1),[r,v]=l.useState(null),[O,y]=l.useState(!1),F=E.data.items.map(a=>({value:a.id,label:`${a.project_code} - ${a.business_initiative_name}`,project:a})),w=[],u=d();u.year(),u.month();for(let a=0;a<12;a++){const i=u.subtract(a,"month"),c=i.format("MMMM"),s=i.year(),b=i.format("YYYY-MM");w.push({value:b,label:`${c} ${s}`})}const S=async a=>{o(!0);try{const{project_id:i,periode_laporan:c}=a,s=d(c),b=s.startOf("month"),L=s.endOf("month");await new Promise(z=>setTimeout(z,1500));const $=X(i,b.format("YYYY-MM-DD"),L.format("YYYY-MM-DD"));v($.data),y(!0),f.success("Laporan berhasil di-generate!")}catch{f.error("Gagal generate laporan")}finally{o(!1)}},R=()=>{if(r){const a=new Date(r.period_start);new Date(r.period_end);const i=P(a.getMonth()+1),c=a.getFullYear();if(f.success(`Laporan periode ${i} ${c} berhasil dicetak`),r.file_path){const s=window.open(r.file_path);s&&s.addEventListener("load",()=>{s.print()})}}},H=()=>{if(r&&r.file_path){const a=document.createElement("a");a.href=r.file_path,a.download=`${r.file_name}.pdf`,document.body.appendChild(a),a.click(),document.body.removeChild(a),f.success("Laporan berhasil didownload!")}},I=()=>{t.resetFields(),v(null),y(!1)};return e.jsxs(p,{direction:"vertical",size:"large",style:{width:"100%"},children:[e.jsx(g,{children:e.jsx(g,{title:"Report Information",children:e.jsx(m,{form:t,layout:"vertical",onFinish:S,children:e.jsxs(k,{gutter:16,children:[e.jsx(_,{span:12,children:e.jsx(m.Item,{label:"Pilih Project",name:"project_id",rules:[{required:!0,message:"Silakan pilih project!"}],children:e.jsx(D,{placeholder:"Pilih project yang akan dilaporkan",showSearch:!0,optionFilterProp:"label",options:F})})}),e.jsx(_,{span:12,children:e.jsx(m.Item,{label:"Periode Laporan",name:"periode_laporan",rules:[{required:!0,message:"Silakan pilih periode laporan!"}],children:e.jsx(D,{placeholder:"Pilih periode laporan",options:w})})})]})})})}),e.jsxs(C,{justify:"flex-end",gap:16,children:[e.jsx(h,{onClick:I,disabled:n,children:"Reset"}),e.jsx(h,{type:"primary",htmlType:"submit",icon:e.jsx(U,{}),loading:n,onClick:()=>t.submit(),children:n?"Generating...":"Generate Laporan"})]}),O&&r&&e.jsx(g,{title:"Preview Laporan",loading:!1,children:e.jsxs(p,{direction:"vertical",size:"middle",style:{width:"100%"},children:[e.jsx(T,{size:"small",children:e.jsx(p,{direction:"vertical",size:"small",style:{width:"100%"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(Z,{level:4,style:{margin:0},children:r.file_name}),e.jsxs(M,{type:"secondary",children:["Periode: ",d(r.period_start).format("DD/MM/YYYY")," - ",d(r.period_end).format("DD/MM/YYYY")]}),e.jsxs(M,{type:"secondary",style:{display:"block"},children:["Generated: ",d(r.generated_at).format("DD/MM/YYYY HH:mm")]})]}),e.jsxs(p,{children:[e.jsx(h,{type:"primary",icon:e.jsx(K,{}),onClick:R,children:"Print Laporan"}),e.jsx(h,{icon:e.jsx(B,{}),onClick:H,children:"Download PDF"})]})]})})}),e.jsx(G,{filePath:r.file_path,fileName:r.file_name,height:"700px",width:"100%"})]})})]})}const we=()=>{const t=[{label:"Laporan",path:"/laporan"}];return e.jsx(V,{title:"Laporan",breadcrumbs:t,noStyle:!0,children:e.jsx(ee,{})})};export{we as Component,we as default};
//# sourceMappingURL=page-CKzYRb1c.js.map
